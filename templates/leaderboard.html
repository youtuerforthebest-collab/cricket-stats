{% extends "base.html" %}
{% block content %}
<section class="hero hero-{{ theme }}">
  <div class="hero-content">
    <h1>{{ page_title }}</h1>
    <p>Track the current season leaders and keep stats up to date.</p>
  </div>
</section>

{% if is_admin %}
<section class="admin-panel">
  <div class="card">
    <h3>Add New Player</h3>
    <form action="/{{ route_prefix }}/add" method="POST" class="form-grid">
      <label>
        Player Name
        <input type="text" name="name" placeholder="Player name" />
      </label>
      <label>
        {{ metric_label }}
        <input type="text" name="value" placeholder="Number" />
      </label>
      <button type="submit" class="primary-btn">Submit</button>
    </form>
  </div>

  <div class="card">
    <h3>Edit Existing Player</h3>
    <form action="/{{ route_prefix }}/edit" method="POST" class="form-grid">
      <label>
        Player Name
        <input type="text" name="name" placeholder="Existing player" />
      </label>
      <label>
        {{ metric_label }} to Add
        <input type="text" name="delta" placeholder="Positive or negative number" />
      </label>
      <button type="submit" class="secondary-btn">Submit</button>
    </form>
  </div>
</section>
{% endif %}

<section class="leaderboard-card card">
  <div class="card-header">
    <h2>{{ page_title }}</h2>
    <span class="tag tag-{{ theme }}">{{ metric_label }}</span>
  </div>

  <div class="table-wrap">
    <table>
      <thead>
        <tr>
          <th>Rank</th>
          <th>Player Name</th>
          <th>Total {{ metric_label }}</th>
        </tr>
      </thead>
      <tbody>
        {% for name, value in leaderboard %}
        <tr>
          <td>{{ loop.index }}</td>
          <td>
            <div class="player-cell">
              <span>{{ name }}</span>
              {% if is_admin %}
              <form action="/{{ route_prefix }}/delete" method="POST" class="delete-form">
                <input type="hidden" name="name" value="{{ name }}" />
                <button type="submit" class="delete-btn" title="Delete {{ name }}">✖</button>
              </form>
              {% endif %}
            </div>
          </td>
          <td>{{ value }}</td>
        </tr>
        {% else %}
        <tr>
          <td colspan="3" class="empty-state">No players yet. Add the first entry.</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</section>

{% if is_admin %}
<section class="card logs-card">
  <div class="card-header">
    <h2>Delete Logs (Last 67)</h2>
    <span class="tag tag-{{ theme }}">Admin Only</span>
  </div>
  {% if delete_logs %}
  <ul class="logs-list">
    {% for log in delete_logs|reverse %}
    <li>
      <strong>{{ log.player }}</strong> — {{ log.category }} ({{ log.value }})
      <span class="log-time">{{ log.ts }}</span>
    </li>
    {% endfor %}
  </ul>
  {% else %}
  <div class="empty-state">No deletions yet.</div>
  {% endif %}
</section>
{% endif %}
{% endblock %}
